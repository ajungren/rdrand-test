# `rdrand-test`

`rdrand-test` verifies the output [`RDRAND`](https://en.wikipedia.org/wiki/RDRAND) on x86/x86_64 processors. It was created to test systems for the [microcode bug in Ryzen 3000 CPUs that cause RDRAND to always return `0xFFFFFFFF`](https://arstechnica.com/gadgets/2019/10/how-a-months-old-amd-microcode-bug-destroyed-my-weekend/) though it is not limited to testing only for that bug.

## Building

Any Rust compiler that supports Rust 2018 should work, but only the latest compiler (Rust 1.40 at the time of this writing) is tested. `rdrand-test` can be run directly by running `cargo run` or built in release mode with `cargo build --release`.

## Usage

TL;DR: To check for the Ryzen 3000 microcode bug, just run `rdrand-test -s` (short for `rdrand-test --smoke-test`). It will run `RDRAND` several times and ensure the same value isn't returned on each iteration. (Because it only checks that the same number isn't generated repeatedly, rather than specifically for `0xFFFFFFFF`, `--smoke-test` will detect any value that is generated by `RDRAND` every time.)

By default, `rdrand-test` will run 500 iterations, where the value is printed and tracked to check for any duplicate values generated across all iterations, for each of the three sizes supported by `RDRAND`: 16-bit, 32-bit, and 64-bit integers. Thanks to the [birthday problem](https://en.wikipedia.org/wiki/Birthday_problem) there is an 85% chance that a 16-bit number will be generated twice across 500 iterations, meaning the 16-bit portion of the test should often show at least one duplicated value.

Adding the `-q`/`--quiet` flag suppresses the output of the generated values, only outputting the number of duplicate values generated, if any.
